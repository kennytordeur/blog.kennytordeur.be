---
layout: post
title: "Asp.net MVC: reuse Areas from external project"
date: 2012-12-16 15:35:00 +0100
comments: true
published: true
categories: ["blog", "archives"]
tags: ["ASP.NET", "MVC 4"]
alias: ["/post/Aspnet-MVC-reuse-Areas-from-external-project", "/post/aspnet-mvc-reuse-areas-from-external-project"]
---
<!-- more -->
{% include imported_disclaimer.html %}
<p>I created a MVC project that has an Area defined that i would like to use in an other MVC project. Here is the structure.</p>
<p><a href="http://lh3.ggpht.com/-1nXZfWz0K2A/UM3p80s6egI/AAAAAAAAAIA/1YBv48ELV24/s1600-h/image%25255B37%25255D.png"><img style="display: inline; border-width: 0px;" title="image" src="http://lh5.ggpht.com/-B9ec-BQT0j8/UM3p9uY9jAI/AAAAAAAAAIE/ZDP0NE7wxUk/image_thumb%25255B21%25255D.png?imgmax=800" alt="image" width="327" height="683" border="0" /></a></p>
<p>I created a reference between the AlphaArea and MainApp project. When i run the application is see that the area registration of the AlphaArea is executed. But when i try to go to the area i get an error.</p>
<p><a href="http://lh4.ggpht.com/-sF8-sqivfoI/UM3p-Rv1aTI/AAAAAAAAAIM/6zv7yiTaKL4/s1600-h/image%25255B11%25255D.png"><img style="float: none; margin-left: auto; display: block; margin-right: auto; border-width: 0px;" title="image" src="http://lh5.ggpht.com/-QGz2ETTp5S4/UM3p_NVjXcI/AAAAAAAAAIU/EX-2P4Xp7t8/image_thumb%25255B7%25255D.png?imgmax=800" alt="image" width="1119" height="302" border="0" /></a></p>
<p>What this error says, is that the view for the Index of the AlphaController in the Alpha area isn&rsquo;t found. This makes perfect sense because the Index view isn&rsquo;t declared in the MainApp project and this is where MVC&nbsp; tries to find the view. We need to make sure that the view engine can resolve the view.</p>
<p>There are a couple solutions to resolve this. We could copy or create a link in the MainApp to the index view that is defined in the AlphaArea. We would need to copy the whole Area structure. Don&rsquo;t know about you but I'm not really found of that solution. An other solution is to compile the AlphaArea views in the DLL. This can be done by a Visual Studio extension and a Nuget package.</p>
<p>First you need to install the Razor Generator extension for Visual Studio.</p>
<p><a href="http://lh4.ggpht.com/-h0KA5qWiacs/UM3p_1e3ZzI/AAAAAAAAAIc/4vnazwoF7_Y/s1600-h/image%25255B16%25255D.png"><img style="float: none; margin-left: auto; display: block; margin-right: auto; border-width: 0px;" title="image" src="http://lh5.ggpht.com/-NKW_3WIn5Z4/UM3qASbq2iI/AAAAAAAAAIk/YVxXPMLgpGA/image_thumb%25255B10%25255D.png?imgmax=800" alt="image" width="648" height="270" border="0" /></a></p>
<p>This extension will create a .cs file for a view, but in the properties of that view, the Custom Tool needs to be set to &ldquo;RazorGenerator&rdquo;.&nbsp; Otherwise the VS extension will not create a .cs file for that view.</p>
<p>&nbsp;</p>
<p><a href="http://lh6.ggpht.com/-xG_eQDy_b0I/UM3qBY5v3CI/AAAAAAAAAIw/EdkLNoArvGc/s1600-h/image%25255B20%25255D.png"><img style="display: inline; border-width: 0px;" title="image" src="http://lh5.ggpht.com/-fxc-c1AuvPM/UM3qCGRT9zI/AAAAAAAAAI4/YrfHTbz5E4k/image_thumb%25255B12%25255D.png?imgmax=800" alt="image" width="383" height="233" border="0" /></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://lh5.ggpht.com/-MfWFmj3uYv4/UM3qCwwMhOI/AAAAAAAAAI8/lKhAmUFclpg/s1600-h/image%25255B24%25255D.png"><img style="display: inline; border-width: 0px;" title="image" src="http://lh5.ggpht.com/-iSSP9EcfDSM/UM3qDlPxj2I/AAAAAAAAAJE/y_4Da-fIAwM/image_thumb%25255B14%25255D.png?imgmax=800" alt="image" width="311" height="274" border="0" /></a></p>
<p>When we compile the project, the view will be added to the DLL of the AlphaArea project. This isn&rsquo;t enough. Now we need a way to tell the view engine that the view can be found in the DLL. Luckily, there is a Nuget package that does the trick. You simply need to install the package &ldquo;RazorGenerator.Mvc&rdquo; in the AlphaArea project.</p>
<p><a href="http://lh5.ggpht.com/-XNY-msYresI/UM3qEkpBwqI/AAAAAAAAAJQ/UaX_bKtF-uA/s1600-h/image%25255B29%25255D.png"><img style="display: inline; border-width: 0px;" title="image" src="http://lh3.ggpht.com/-r1flSGRCPoY/UM3qRjf_NwI/AAAAAAAAAJg/rul0hItf4SA/image_thumb%25255B17%25255D.png?imgmax=800" alt="image" width="659" height="258" border="0" /></a></p>
<p>This package will add a file (RazorGeneratorMvcStart) in the AppStart folder. This file will create a PrecompiledMvcEngine and add it to the ViewEngines. The code will be executed when the applications starts. This is done by using the WebActivator.</p>
<pre class="code"><span style="background: white; color: blue;">using </span><span style="background: white; color: black;">System.Web;<br /></span><span style="background: white; color: blue;">using </span><span style="background: white; color: black;">System.Web.Mvc;<br /></span><span style="background: white; color: blue;">using </span><span style="background: white; color: black;">System.Web.WebPages;<br /></span><span style="background: white; color: blue;">using </span><span style="background: white; color: black;">RazorGenerator.Mvc;<br /><br />[</span><span style="background: white; color: blue;">assembly</span><span style="background: white; color: black;">: WebActivator.</span><span style="background: white; color: #2b91af;">PostApplicationStartMethod</span><span style="background: white; color: black;">(</span><span style="background: white; color: blue;">typeof</span><span style="background: white; color: black;">(AlphaArea.App_Start.</span><span style="background: white; color: #2b91af;">RazorGeneratorMvcStart</span><span style="background: white; color: black;">), </span><span style="background: white; color: #a31515;">"Start"</span><span style="background: white; color: black;">)]<br /><br /></span><span style="background: white; color: blue;">namespace </span><span style="background: white; color: black;">AlphaArea.App_Start {<br />    </span><span style="background: white; color: blue;">public static class </span><span style="background: white; color: #2b91af;">RazorGeneratorMvcStart </span><span style="background: white; color: black;">{<br />        </span><span style="background: white; color: blue;">public static void </span><span style="background: white; color: black;">Start() {<br />            </span><span style="background: white; color: blue;">var </span><span style="background: white; color: black;">engine = </span><span style="background: white; color: blue;">new </span><span style="background: white; color: #2b91af;">PrecompiledMvcEngine</span><span style="background: white; color: black;">(</span><span style="background: white; color: blue;">typeof</span><span style="background: white; color: black;">(</span><span style="background: white; color: #2b91af;">RazorGeneratorMvcStart</span><span style="background: white; color: black;">).Assembly) {<br />                UsePhysicalViewsIfNewer = </span><span style="background: white; color: #2b91af;">HttpContext</span><span style="background: white; color: black;">.Current.Request.IsLocal<br />            };<br /><br />            </span><span style="background: white; color: #2b91af;">ViewEngines</span><span style="background: white; color: black;">.Engines.Insert(0, engine);<br /><br />            </span><span style="background: white; color: green;">// StartPage lookups are done by WebPages. <br />            </span><span style="background: white; color: #2b91af;">VirtualPathFactoryManager</span><span style="background: white; color: black;">.RegisterVirtualPathFactory(engine);<br />        }<br />    }<br />}</span></pre>
<p>&nbsp;</p>
<p>When we now run the application and go to the Alpha area, the view is resolved.</p>
<p>&nbsp;</p>
<p><a href="http://lh6.ggpht.com/-_3b2QYwwlTk/UM3qSBhMM0I/AAAAAAAAAJk/TOmJ3NCtsqU/s1600-h/image%25255B33%25255D.png"><img style="display: inline; border-width: 0px;" title="image" src="http://lh3.ggpht.com/-WdwDCtwG0Mc/UM3qS_vCJJI/AAAAAAAAAJs/I_N0jwbUxZU/image_thumb%25255B19%25255D.png?imgmax=800" alt="image" width="1018" height="84" border="0" /></a></p>
<p>&nbsp;</p>
<p>The same system can also be used on Controllers in external projects. The example for the post can be downloaded <a href="http://dl.dropbox.com/u/41091233/Blog/Asp.net%20MVC%204%20Reuse%20Area/Asp.net%20MVC%204%20Reuse%20Area.rar" target="_blank">here</a>.</p>
