---
layout: post
title: "WCF KnownType"
date: 2011-03-24 06:14:00 +0100
comments: true
published: true
categories: ["blog", "archives"]
tags: ["WCF"]
alias: ["/post/WCF-KnownType", "/post/wcf-knowntype"]
---
<!-- more -->
{% include imported_disclaimer.html %}
<p>In object-oriented programming the concept of polymorphism is frequently used. This can cause problems in a WCF service if no action is taken. This is where <strong>KnownType</strong> comes to the rescue.</p>
<p>This is the WCF service that we are going to use in this example.</p>
<p>&nbsp;</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:6f3a6ab4-8397-4be2-96de-a7db0e174631" class="wlWriterEditableSmartContent" style="display: inline; float: none; margin: 0px; padding: 0px;">
<div class="le-pavsc-container">
<div style="background-color: #ffffff; max-height: 300px; overflow: auto; padding: 2px 5px; white-space: nowrap;">[<span style="color: #2b91af;">ServiceContract</span>(<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Namespace=<span style="color: #a31515;">"http://localhost/WeatherForeCast"</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,Name=<span style="color: #a31515;">"WeatherForeCastService"</span>)]<br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span> <span style="color: #2b91af;">IWeatherForeCastService</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;{<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color: #2b91af;">OperationContract</span>]<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #2b91af;">WeatherForeCast</span> GetWeatherForeCast(<span style="color: #2b91af;">DateTime</span> day);<br /> &nbsp;&nbsp;&nbsp;&nbsp;}</div>
</div>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:b8286a00-9a60-41bb-923f-9dad65ef237e" class="wlWriterEditableSmartContent" style="display: inline; float: none; margin: 0px; padding: 0px;">
<div class="le-pavsc-container">
<div style="background-color: #ffffff; max-height: 500px; overflow: auto; padding: 2px 5px; white-space: nowrap;"><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> <span style="color: #2b91af;">WeatherForeCastService</span> : <span style="color: #2b91af;">IWeatherForeCastService</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;{<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">public</span> <span style="color: #2b91af;">WeatherForeCast</span> GetWeatherForeCast(<span style="color: #2b91af;">DateTime</span> day)<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> <span style="color: #2b91af;">WeatherForeCast</span> { Celsius = 30, Day = day };<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> &nbsp;&nbsp;&nbsp;&nbsp;}</div>
</div>
</div>
<p>&nbsp;</p>
<p>This service has only 1 method. The GetWeatherForeCast method gives us a weather forecast for a specific day ( = parameter ).</p>
<p>This is how the WeatherForeCast object looks like.</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:95b4a887-173b-4259-8c47-c69ba62a729c" class="wlWriterEditableSmartContent" style="display: inline; float: none; margin: 0px; padding: 0px;">
<div class="le-pavsc-container">
<div style="background-color: #ffffff; max-height: 300px; overflow: auto; padding: 2px 5px; white-space: nowrap;">[<span style="color: #2b91af;">DataContract</span>]<br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> <span style="color: #2b91af;">WeatherForeCast</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;{<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color: #2b91af;">DataMember</span>]<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Celsius { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span>; }<br /> <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color: #2b91af;">DataMember</span>]<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">public</span> <span style="color: #2b91af;">DateTime</span> Day { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span>; }<br /> &nbsp;&nbsp;&nbsp;&nbsp;}</div>
</div>
</div>
<p>Fore some reason, the service method must also return Farenheit as property on all the uneven days. So we decide to create a new class WeatherForeCastExtra that inherits from WeatherForeCast and add the extra property.</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:5dafbbd8-9663-445a-b1a2-1c89fe47c7f1" class="wlWriterEditableSmartContent" style="display: inline; float: none; margin: 0px; padding: 0px;">
<div class="le-pavsc-container">
<div style="background-color: #ffffff; max-height: 300px; overflow: auto; padding: 2px 5px; white-space: nowrap;">[<span style="color: #2b91af;">DataContract</span>]<br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> <span style="color: #2b91af;">WeatherForeCastExtra</span>: <span style="color: #2b91af;">WeatherForeCast</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color: #2b91af;">DataMember</span>]<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Farenheit { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span>; }<br /> &nbsp;&nbsp;&nbsp;&nbsp;}</div>
</div>
</div>
<p>Off course we also have to modify our service so that it could return a WeatherForeCastExtra object on all the uneven days.</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:6e0ccf22-b082-408b-a301-3c2f60af774b" class="wlWriterEditableSmartContent" style="display: inline; float: none; margin: 0px; padding: 0px;">
<div class="le-pavsc-container">
<div style="background-color: #ffffff; overflow: auto; padding: 2px 5px; white-space: nowrap;"><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> <span style="color: #2b91af;">WeatherForeCastService</span> : <span style="color: #2b91af;">IWeatherForeCastService</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;{<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">public</span> <span style="color: #2b91af;">WeatherForeCast</span> GetWeatherForeCast(<span style="color: #2b91af;">DateTime</span> day)<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">if</span> ((day.Day % 2) == 0)<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> <span style="color: #2b91af;">WeatherForeCast</span> { Celsius = 30, Day = day };<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">else</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> <span style="color: #2b91af;">WeatherForeCastExtra</span> { Celsius = 30, Farenheit = 86, Day=day};<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> &nbsp;&nbsp;&nbsp;&nbsp;}</div>
</div>
</div>
<p>If we now create a client for this and ask for a forecast on a even day, it will work fine. If you ask for a forecast on an uneven day, you will get an error.</p>
<p>&nbsp;</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:397b2b78-4889-42f6-862b-2fa851b50324" class="wlWriterEditableSmartContent" style="display: inline; float: none; margin: 0px; padding: 0px;">
<div class="le-pavsc-container">
<div style="background-color: #ffffff; overflow: auto; padding: 2px 5px; white-space: nowrap;"><span style="color: #0000ff;">namespace</span> WeatherForeCastClient<br /> {<br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">class</span> <span style="color: #2b91af;">Program</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;{<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Main(<span style="color: #0000ff;">string</span>[] args)<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">using</span> (WeatherForeCastService.<span style="color: #2b91af;">WeatherForeCastServiceClient</span> client = <span style="color: #0000ff;">new</span> WeatherForeCastService.<span style="color: #2b91af;">WeatherForeCastServiceClient</span>())<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WeatherForeCastService.<span style="color: #2b91af;">WeatherForeCast</span> weatherForeCast = client.GetWeatherForeCast(<span style="color: #0000ff;">new</span> <span style="color: #2b91af;">DateTime</span>(2011, 3, 24));<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weatherForeCast = client.GetWeatherForeCast(<span style="color: #0000ff;">new</span> <span style="color: #2b91af;">DateTime</span>(2011, 3, 23));<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /> &nbsp;&nbsp;&nbsp;&nbsp;}<br /> }</div>
</div>
</div>
<p>&nbsp;</p>
<p>The problem is that the client doesn&rsquo;t have any idea how the WeatherForeCastExtra object looks like or how it has to be deserialized. If we look at the WSDL our service generates, we can&rsquo;t find a definition for the WeatherForeCastExtra type.</p>
<p><a href="http://lh5.ggpht.com/_VX53QHr178k/TYrhTVHh-JI/AAAAAAAAAB8/dR90TWveW-o/s1600-h/image16.png"><img style="display: inline; border-width: 0px;" title="image" src="http://lh5.ggpht.com/_VX53QHr178k/TYrhUc4BV9I/AAAAAAAAACA/W1IDu8ZOA5I/image_thumb10.png?imgmax=800" alt="image" width="757" height="214" border="0" /></a>&nbsp;</p>
<p>&nbsp;</p>
<p>It&rsquo;s kind of logic that we can&rsquo;t find a definition for the WeatherForeCastExtra type. If we look at our service interface, we see that the service returns the WeatherForeCast type. We have to find some way to tell the client that the service also returns something off the WeatherForeCastExtra type. This is were KnownType comes into action.</p>
<p>The KnownType attribute lets you specify types that should be include during serialization/deserialization. We have to use this attribute in our base class ( WeatherForeCast ).</p>
<p>&nbsp;</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:b2296b00-fb7e-4fdc-84f3-ef984a94b830" class="wlWriterEditableSmartContent" style="display: inline; float: none; margin: 0px; padding: 0px;">
<div class="le-pavsc-container">
<div style="background-color: #ffffff; overflow: auto; padding: 2px 5px; white-space: nowrap;">[<span style="color: #2b91af;">KnownType</span>(<span style="color: #0000ff;">typeof</span>(<span style="color: #2b91af;">WeatherForeCastExtra</span>))]<br /> [<span style="color: #2b91af;">DataContract</span>]<br /> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> <span style="color: #2b91af;">WeatherForeCast</span><br /> {<br /> &nbsp;&nbsp;&nbsp;&nbsp;[<span style="color: #2b91af;">DataMember</span>]<br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Celsius { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span>; }<br /> <br /> &nbsp;&nbsp;&nbsp;&nbsp;[<span style="color: #2b91af;">DataMember</span>]<br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">public</span> <span style="color: #2b91af;">DateTime</span> Day { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span>; }<br /> }</div>
</div>
</div>
<p>If we now look at the generate WSDL file of our service, we will find a definition for our WeatherForeCastExtra type and the DataContractSerializer will know how the serialize or deserialize our WeatherForeCastExtra type.</p>
<p><a href="http://lh6.ggpht.com/_VX53QHr178k/TYrhU5x8BvI/AAAAAAAAACE/Drr_gmGqZeY/s1600-h/image29.png"><img style="display: inline; border-width: 0px;" title="image" src="http://lh4.ggpht.com/_VX53QHr178k/TYrhVMVpL9I/AAAAAAAAACI/8mmHzlp458Y/image_thumb21.png?imgmax=800" alt="image" width="835" height="308" border="0" /></a></p>
<p>If we run our client now, we won&rsquo;t get an exception on uneven days.</p>
<p>You can imagine that, if you have to include 10 types, your class would be decorated with 10 KnownType attributes and would be a little hard to read. This is why the KnownType attribute has another constructor. This constructor accepts a method name, as a string, of a static method that returns an array of types. These types will be include in the WDSL definition of the service.</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:964f3f0d-085c-4f18-b67e-e241eb6aa13c" class="wlWriterEditableSmartContent" style="display: inline; float: none; margin: 0px; padding: 0px;">
<div class="le-pavsc-container">
<div style="background-color: #ffffff; overflow: auto; padding: 2px 5px; white-space: nowrap;">[<span style="color: #2b91af;">KnownType</span>(<span style="color: #a31515;">"GetKnowTypes"</span>)]<br /> [<span style="color: #2b91af;">DataContract</span>]<br /> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> <span style="color: #2b91af;">WeatherForeCast</span><br /> {<br /> &nbsp;&nbsp;&nbsp;&nbsp;[<span style="color: #2b91af;">DataMember</span>]<br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> Celsius { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span>; }<br /> <br /> &nbsp;&nbsp;&nbsp;&nbsp;[<span style="color: #2b91af;">DataMember</span>]<br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">public</span> <span style="color: #2b91af;">DateTime</span> Day { <span style="color: #0000ff;">get</span>; <span style="color: #0000ff;">set</span>; }<br /> <br /> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">static</span> <span style="color: #2b91af;">Type</span>[] GetKnowTypes()<br /> &nbsp;&nbsp;&nbsp;&nbsp;{<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> <span style="color: #2b91af;">Type</span>[] { <span style="color: #0000ff;">typeof</span>(<span style="color: #2b91af;">WeatherForeCastExtra</span>) };<br /> &nbsp;&nbsp;&nbsp;&nbsp;}<br /> }</div>
</div>
</div>
<p>This will return the same WSDL as before and our client will still work.</p>
<div id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:46ca5899-ef62-48fc-add4-a72852dfdedc" class="wlWriterEditableSmartContent" style="display: inline; float: none; margin: 0px; padding: 0px;">Technorati Tags: <a href="http://technorati.com/tags/WCF" rel="tag">WCF</a>,<a href="http://technorati.com/tags/KnownType" rel="tag">KnownType</a></div>
